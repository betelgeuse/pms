\chapter{Tree Layout}

\section{Top Level}

An ebuild repository shall occupy one directory on disk, with the following subdirectories:
\begin{itemize}
\item One directory per category, whose name shall be the name of the category. The layout of
    these directories shall be as described in section \ref{category-dirs}.
\item A \t{profiles} directory, described in section \ref{profiles-dir}.
\item A \t{licenses} directory (optional), described in section \ref{licenses-dir}.
\item An \t{eclass} directory (optional), described in section \ref{eclass-dir}.
\item A \t{metadata} directory (optional), described in section \ref{metadata-dir}.
\item Other optional support files (skeleton ebuilds or ChangeLogs, for example) may exist
    but are not covered by this specification.

\end{itemize}

\section{Category Directories}
\label{category-dirs}

Each category provided by the repository (see also: the \t{profiles/categories} file, section
\ref{profiles-categories}) shall be contained in one directory, whose name shall be that of the
category. Each category directory shall contain:
\begin{itemize}
\item A \t{metadata.xml} file, as described in appendix \ref{metadata-xml}. Optional.
\item Zero or more package directories, one for each package in the category, as described in section
    \ref{package-dirs}. The name of the package directory shall be the corresponding package name.
\end{itemize}

\section{Package Directories}
\label{package-dirs}

A package directory contains the following:
\begin{itemize}
\item One or more ebuilds. These are as described in section \ref{ebuild-format} and others.
\item A \t{metadata.xml} file, as described in appendix \ref{metadata-xml}.
\item A \t{ChangeLog}, in a format determined by the provider of the respository. Optional.
\item A \t{Manifest} file, whose format is described in \cite{Glep44}
\item A \t{files} directory, containing any support files needed by the ebuilds.
\end{itemize}

\section{The Profiles Directory}
\label{profiles-dir}

The profiles directory shall contain zero or more profile directories as described in section
\ref{profiles}, as well as the following files and directories. In any line-based file, lines
beginning with a \# character are treated as comments, while blank lines are ignored.
\begin{description}
\item[arch.list] Contains a list, one entry per line, of permissible values for the \t{ARCH}
    variable.
\item[categories] \label{profiles-categories} Contains a list, one entry per line, of categories
    provided by this repository.
\item[info\_pkgs] Contains a list, one entry per line, of (EAPI-0) dependency atoms. Any package
    matching one of these is to be listed when a package manager displays a `system information'
    listing.
\item[info\_vars] Contains a list, one entry per line, of profile, configuration, and environment
    variables which are considered to be of interest. The value of each of these is to be included
    when the package manager displays a `system information' listing.
\item[package.mask] \label{profiles-package.mask}
    Contains a list, one entry per line, of (EAPI-0) dependency atoms. Any package
    version matching one of these is considered to be masked, and will not be installed regardless
    of profile unless it is unmasked by the user configuration.
\item[profiles.desc] Described below in section \ref{profiles.desc}.
\item[repo\_name] Contains, on a single line, the name of this repository. The repository name must
    conform to section \ref{repository-names}.
\item[thirdpartymirrors] Described below in section \ref{thirdpartymirrors}.
\item[use.desc] Contains descriptions of valid global USE flags for this repository. The format is
    described in section \ref{use.desc}.
\item[use.local.desc] Contains descriptions of valid local USE flags for this repository, along with
    the packages to which they apply. The format is as described in section \ref{use.desc}.
\item[desc/] This directory contains files analogous to \t{use.desc} for the various \t{USE\_EXPAND}
    variables. Each file in it is named \t{<varname>.desc}, where \t{<varname>} is the variable
    name, in lowercase, whose possible values the file describes. The format of each file is as for
    \t{use.desc}, described in section \ref{use.desc}.
\item[updates/] This directory is described in section \ref{updates-dir}.
\end{description}

\subsection{The profiles.desc file}
\label{profiles.desc}
\t{profiles.desc} is a line-based file, with the standard commenting rules from section
\ref{profiles-dir}, containing a list of profiles that are valid for use, along with their
associated architecture and status. Each line has the format:
\begin{verbatim}
<arch> <profile path> stable|dev
\end{verbatim}
Where \t{<arch>} is the architecture for which the profile is valid, \t{<profile path>} is the path
from the \t{profiles} directory to the profile in question, and the third field is either \t{stable}
or \t{dev}, depending upon whether the profile is reckoned to be `stable' for normal use. Fields are
whitespace-delimited. The last field is of most use to QA scanning tools, which can display certain
errors with reduced severity should they appear in a `dev' profile.

\subsection{The thirdpartymirrors file}
\label{thirdpartymirrors}
\t{thirdpartymirrors} is another simple line-based file, describing the valid mirrors for use with
\t{mirror://} URIs in this repository, and the associated download locations. The format of each
line is:
\begin{verbatim}
<mirror name> <mirror 1> <mirror 2> ... <mirror n>
\end{verbatim}
Fields are whitespace-delimited. When parsing a URI of the form \t{mirror://name/filename}, the
\t{thirdpartymirrors} file is searched for a line whose first field is \t{name}. Then the download
URIs in the subsequent fields have \t{filename} appended to them to generate the URIs from which a
download is attempted.

\subsection{use.desc and related files}
\label{use.desc}
\t{use.desc} contains descriptions of every valid global USE flag for this repository. It is a
line-based file with the standard rules for comments and blank lines. The format of each line is:
\begin{verbatim}
<flagname> - <description>
\end{verbatim}

\t{use.local.desc} contains descriptions of every valid local USE flag -- those that apply only to a
small number of packages, or that have different meanings for different packages. Its format is:
\begin{verbatim}
<category/package>:<flagname> - <description>
\end{verbatim}
Flags must be listed once for each package to which they apply, or if a flag is listed in both
\t{use.desc} and \t{use.local.desc}, it must be listed once for each package for which its meaning
differs from that described in \t{use.desc}.

\subsection{The updates directory}
\label{updates-dir}
The \t{updates} directory is used to inform the package manager that a package has moved categories,
names, or that a version has changed SLOT. It contains one file per quarter year, named
\t{[1-4]Q-[YYYY]} for the first to fourth quarter of a given year, for example \t{1Q-2004} or
\t{3Q-2006}. The format of each file is again line-based, with each line having one of the following
formats:
\begin{verbatim}
move <qpn1> <qpn2>
slotmove <atom> <slot1> <slot2>
\end{verbatim}
The first form, where \t{qpn1} and \t{qpn2} are \e{qualified package names}, instructs the package
manager that the package \t{qpn1} has changed name, category, or both, and is now called \t{qpn2}.

The second form instructs the package manager that any package version matching \t{atom} whose
\t{SLOT} is set to \t{slot1} should have it updated to \t{slot2}.


\section{The Licenses Directory}
\label{licenses-dir}

The \t{licenses} directory shall contain copies of the licenses used by packages in the
repository. Each file will be named according to the name used in the \t{LICENSE} variable as
described in section \ref{ebuild-var-LICENSE}, and will contain the complete text of the license in
human-readable form. Plain text and PDF formats are permitted, with the former strongly preferred.

\section{The Eclass Directory}
\label{eclass-dir}

The \t{eclass} directory shall contain copies of the eclasses provided by this repository. The
format of these files is described in section \ref{eclasses}. It may also contain, in their own
directory, support files needed by these eclasses.

\section{The Metadata Directory}
\label{metadata-dir}

% vim: set filetype=tex fileencoding=utf8 et tw=100 spell spelllang=en :
