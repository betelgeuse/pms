\chapter{Ebuild-defined Variables}
\label{ebuild-vars}

\note This section describes variables that may or must be defined by ebuilds. For
variables that are passed from the package manager to the ebuild, see section \ref{ebuild-env-vars}.

\section{Metadata invariance}
\label{metadata-invariance}

All ebuild-defined variables discussed in this chapter must be defined independently of
any system, profile or tree dependent data, and must not vary depending upon the ebuild
phase. In particular, ebuild metadata can and will be generated on a different system from that upon
which the ebuild will be used, and the ebuild must generate identical metadata every time it
is used.

Globally defined ebuild variables without a special meaning must similarly not rely upon
variable data.

\TODO{Wording sucks}

\section{Mandatory Ebuild-defined Variables}

All ebuilds must define at least the following variables:

\begin{description}
\item[DESCRIPTION] A short human-readable description of the package's purpose. May be defined by an
    eclass.
\item[SRC\_URI] A list of source URIs for the package. Valid protocols are \t{http://},
    \t{https://}, \t{ftp://} and \t{mirror://} (see section \ref{thirdpartymirrors} for mirror behaviour).
    Fetch restricted packages may include URL parts consisting of just a filename.  Use-conditional and
    all-of groups are allowed (see section \ref{dependencies}); other constructs,
    such as any-of groups, are forbidden. May be defined by an eclass, and may be empty.
\item[HOMEPAGE] The URI for a package's homepage or (whitespace separated) the URIs for a package's
    homepages, including protocol. May be defined by an eclass.
\item[SLOT] The package's slot. Must be a valid slot name, as per section \ref{slot-names}. May
    be defined by an eclass.
\item[LICENSE] The package's license. Each text token must correspond to a tree ``licenses/`` entry
    (see section \ref{licenses-dir}). Use-conditional, any-of and all-of groups are allowed.
    May be defined by an eclass. \label{ebuild-var-LICENSE}
\item[IUSE] The \t{USE} flags used by the ebuild. Historically, \t{USE\_EXPAND} values and \t{ARCH}
    were not included; package managers should support this for backwards compatibility reasons. Ebuilds
    should list only flags used by the ebuild itself. Any eclass that works with \t{USE} flags
    should also set \t{IUSE}, listing only the variables used by that eclass. The package manager is
    responsible for merging these values.
\item[KEYWORDS] A whitespace separated list of keywords for the ebuild. Each token must be a
    valid keyword name, as per section \ref{keyword-names}. May include $-*$, which
    indicates that the package will only work on explicitly listed archs. May include $-arch$,
    which indicates that the package will not work on the specified arch. May be empty, which
    indicates uncertain functionality on any architecture.
\end{description}

\TODOBUG{170165}{\t{KEYWORDS} in eclass is banned by the above. Do we drop this requirement and just consider
    it to be a QA thing?}

If any of these variables are undefined, or if any of these variables are set to invalid values,
the package manager's behaviour is undefined; ideally, an error in one ebuild should not prevent
operations upon other ebuilds or packages.

\section{Optional Ebuild-defined Variables}

Ebuilds may define any of the following variables:

\begin{description}
\item[S] The path to the temporary build directory, used by \t{src\_compile}, \t{src\_install}
    etc. Defaults to \t{\$\{WORKDIR\}/\$\{P\}}.
\item[DEPEND] See section \ref{dependencies}.
\item[RDEPEND] See section \ref{dependencies}.
\item[PDEPEND] See section \ref{dependencies}.
\item[PROVIDE] Zero or more qualified package names of any \e{old style}
    virtuals provided by this package. May contain use conditionals. May not contain version
    restrictions. \label{ebuild-var-provide}
\item[EAPI] The EAPI, by default \t{0}.
\item[RESTRICT] See section \ref{restrict}.
\end{description}

If any of these variables are set to invalid values, the package manager's behaviour is undefined;
ideally, an error in one ebuild should not prevent operations upon other ebuilds or packages.

\subsection{Restrict}
\label{restrict}

The \t{RESTRICT} variable may contain zero or more whitespace separated tokens. The following
tokens have predefined meanings:

\begin{description}
\item[mirror] The package's \t{SRC\_URI} entries may not be mirrored, and mirrors should not
    be checked when fetching.
\item[fetch] The package's \t{SRC\_URI} entries may not be downloaded automatically. If
    entries are not available, \t{pkg\_nofetch} is called.
\item[strip] No stripping of files to be installed may be performed.
\item[userpriv] The package manager may not drop root privileges when building the package.
\item[test] The \t{src\_test} phase must not be run.
\item[sandbox] The \t{sandbox} tool must not be used when building the package.
\end{description}

Package managers may recognise other tokens, but ebuilds may not rely upon them being supported.

\TODO{Portage allows use conditionals here. Is this useful behaviour?}

\section{Magic Ebuild-defined Variables}

The following variables must be defined by \t{inherit}, and may be considered to be part
of the ebuild's metadata:

\begin{description}
\item[INHERITED] List of inherited eclass names. This is handled magically by \t{inherit} and
    shouldn't be modified manually.
\item[ECLASS] The current eclass, or unset if there is no current eclass. Again, this is handled
    magically by \t{inherit}.
\end{description}

\note Thus, by extension of section \ref{metadata-invariance}, \t{inherit} may not be used
    conditionally, except upon constant conditions.

% vim: set filetype=tex fileencoding=utf8 et tw=100 spell spelllang=en :
