\chapter{Ebuild-defined Variables}
\label{ebuild-vars}

\note This section describes variables that may or must be defined by ebuilds. For
variables that are passed from the package manager to the ebuild, see section \ref{ebuild-env-vars}.

\section{Mandatory Ebuild-defined Variables}

All ebuilds must define at least the following variables:

\begin{description}
\item[DESCRIPTION] A short human-readable description of the package's purpose. May be defined by an
    eclass.
\item[SRC\_URI] A list of source URIs for the package. Valid protocols are \t{http://},
    \t{https://}, \t{ftp://} and \t{mirror://\} (see section \{thirdpartymirrors} for mirror behaviour).
    Fetch restricted packages may include URL parts consisting of just a filename.  Use-conditional and
    All-of groups are allowed; other constructs, such as any-of groups, are forbidden. May be defined by
    an eclass, and may be empty.
\item[HOMEPAGE] The package's homepage or (whitespace separated) homepages, including protocol. May
    be defined by an eclass.
\item[SLOT] The package's slot. Must be a valid slot name, as per section \ref{slot-names}. May
    be defined by an eclass.
\item[LICENSE] The package's license. Each text token must correspond to a tree ``licenses/`` entry
    (see section \ref{licenses-dir}). Use-conditional, any-of and all-of groups are allowed.
    May be defined by an eclass.
\item[IUSE] The \t{USE} flags used by the ebuild. Historically, \t{USE\_EXPAND} values were not
    included; package managers should support this for backwards compatibility reasons. Ebuilds
    should list only flags used by the ebuild itself. Any eclass that works with \t{USE} flags
    should also set \t{IUSE}, listing only the variables used by that eclass. The package manager is
    responsible for merging these values.
\item[KEYWORDS] A whitespace separated list of keywords for the ebuild. Each token must be a
    valid keyword name, as per section \ref{keyword-names}. May include $-*$, which
    indicates that the package will only work on explicitly listed archs. May include $-arch$,
    which indicates that the package will not work on the specified arch.
\end{description}

If any of these variables are undefined, or if any of these variables are set to invalid values,
the package manager's behaviour is undefined; ideally, an error in one ebuild should not prevent
operations upon other ebuilds or packages.

\section{Optional Ebuild-defined Variables}

Ebuilds may define any of the following variables:

\begin{description}
\item[S] The path to the temporary build directory, used by \t{src\_compile}, \t{src\_install}
    etc. Defaults to \t{\$\{WORKDIR\}/\$\{P\}}.
\item[DEPEND] See section \ref{dependencies}.
\item[RDEPEND] See section \ref{dependencies}.
\item[PDEPEND] See section \ref{dependencies}.
\item[PROVIDE] Any \e{old style} virtuals provided by this package. May contain use conditionals.
    \label{ebuild-var-provide}
\item[EAPI] The EAPI, by default \t{0}.
\item[INHERITED] List of inherited eclass names. This is handled magically by \t{inherit} and
    shouldn't be modified manually.
\item[RESTRICT] Zero or more of \t{mirror}, \t{fetch}, \t{strip}. Package managers may recognise
    other values, but ebuilds may not rely upon them being supported.
\end{description}

If any of these variables are set to invalid values, the package manager's behaviour is undefined;
ideally, an error in one ebuild should not prevent operations upon other ebuilds or packages.

\section{Dependencies}
\label{dependencies}

There are three categories of dependencies supported by ebuilds:

\begin{bulletlist}
\item Build dependencies (\t{DEPEND}). These must be installed before the ebuild is installed.
\item Runtime dependencies (\t{RDEPEND}). These should usually be installed before the ebuild,
    but may be dropped to post dependencies where necessary to resolve cycles.
\item Post dependencies (\t{PDEPEND}). These should be installed at some point, usually after
    the ebuild if they are not already installed.
\end{bulletlist}

The dependency specification format is a string containing zero or more of the following
items separated by whitespace:

\begin{bulletlist}
\item A package dependency specification (for \t{DEPEND} etc.), or a URI (for \t{SRC\_URI}),
    or a package name (for \t{PROVIDE}), or a license name (for \t{LICENSE}).
\item An all-of group, which consists of an open parenthesis, followed by whitespace,
    followed by zero or more dependency items of any kind, followed by whitespace, followed
    by a close parenthesis.
\item An any-of group, which consists of the string \t{||}, followed by whitespace,
    followed by an open parenthesis, followed by zero or more dependency items of any kind,
    followed by whitespace, followed by a close parenthesis.
\item A use-conditional group, which consists of an optional exclamation mark, followed by
    a use flag name, followed by a question mark, followed by whitespace, followed by
    an open parenthesis, followed by zero or more dependency items of any kind, followed by
    whitespace, followed by a close parenthesis.
\end{bulletlist}

A package dependency can be in one of the following base formats:

\begin{bulletlist}
\item A simple \t{category/package} name.
\item An operator, followed immediately by \t{category/package}, followed by a hyphen,
   followed by a version specification.
\end{bulletlist}

The following operators are available:

\begin{description}
\item[\t{<}] Strictly less than the specified version.
\item[\t{<=}] Less than or equal to the specified version.
\item[\t{=}] Exactly equal to the specified version. Special exception: if the version
    specified has an asterisk immediately following it, a string prefix comparison is
    used instead.
\item[\t{\~}] Equal to the specified version, except the revision part of the matching
    package may be greater than the revision part of the specified version.
\item[\t{>=}] Greater than or equal to the specified version.
\item[\t{>}] Strictly greater than the specified version.
\end{description}

If the operator is prefixed with an exclamation mark, the named dependency is a block
rather than a requirement -- that is to say, the specified package must not be
installed, except with the following exceptions:

\begin{bulletlist}
\item Blocks on a package provided by the ebuild do not count.
\item Blocks on the ebuild itself do not count.
\end{bulletlist}

In an all-of group, all of the child elements must be installed.

In a use-conditional group, if the use flag is enabled (or disabled if it has an exclamation mark
prefix), all of the child elements must be installed.

In an any-of group, at least one child element must be installed. An empty any-of group
counts as being installed. Any use-conditional group that is an immediate child of an
any-of group, if not enabled, is not considered a member of the any-of group.

% vim: set filetype=tex fileencoding=utf8 et tw=100 spell spelllang=en :
